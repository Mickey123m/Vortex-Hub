-- =============================================
-- FUNÇÃO PARA O AUTO FARM BRAINROT (ATUALIZADA)
-- =============================================
local brainrotActive = false
local brainrotThread = nil

local function StartBrainrotFarm()
    if brainrotActive then return end
    
    -- Ativar visualmente primeiro
    brainrotActive = true
    TweenService:Create(BrainrotSwitch, TweenInfo.new(0.3), {BackgroundColor3 = AutoFarmColor}):Play()
    TweenService:Create(BrainrotCircle, TweenInfo.new(0.3), {Position = UDim2.new(1, -17, 0.5, -7), BackgroundColor3 = Color3.new(1, 1, 1)}):Play()
    
    -- Obter valores dos campos
    local minValue = tonumber(BrainrotValueInput.Text) or 100
    local webhook = BrainrotWebhookInput.Text
    local discordID = "" -- Você pode adicionar um campo para Discord ID se quiser
    
    -- Travar campos
    BrainrotValueInput.TextEditable = false
    BrainrotValueInput.TextColor3 = Color3.fromRGB(180, 180, 180)
    BrainrotWebhookInput.TextEditable = false
    BrainrotWebhookInput.TextColor3 = Color3.fromRGB(180, 180, 180)
    
    -- Notificar início
    ShowNotification("Auto Farm Brainrot", "Iniciando Auto Farm... Valor: " .. minValue, 2)
    
    -- URL do script de Auto Farm Brainrot
    local scriptUrl = "https://raw.githubusercontent.com/Mickey123m/Vortex-Hub/refs/heads/main/Games/BreakALuckyBlock/AUTOFARM/AUTO_AutoFarmBrainrot"
    
    -- Armazenar para poder parar depois
    ActiveToggles["BrainrotFarm"] = scriptUrl
    
    -- Executar a loadstring em uma thread separada
    brainrotThread = task.spawn(function()
        -- Passar valores para o script
        _G.VortexHubValues = {
            MinValue = minValue,
            Webhook = webhook,
            DiscordID = discordID
        }
        
        local success, result = pcall(function()
            local scriptContent = game:HttpGet(scriptUrl)
            local loadedScript = loadstring(scriptContent)
            if loadedScript then
                return loadedScript()
            end
            return nil
        end)
        
        if not success then
            ShowNotification("Erro", "Falha ao ativar: " .. tostring(result), 5)
            -- Reverter
            brainrotActive = false
            TweenService:Create(BrainrotSwitch, TweenInfo.new(0.3), {BackgroundColor3 = Color3.fromRGB(60, 60, 75)}):Play()
            TweenService:Create(BrainrotCircle, TweenInfo.new(0.3), {Position = UDim2.new(0, 3, 0.5, -7), BackgroundColor3 = Color3.fromRGB(200, 200, 200)}):Play()
            BrainrotValueInput.TextEditable = true
            BrainrotValueInput.TextColor3 = Color3.fromRGB(255, 255, 255)
            BrainrotWebhookInput.TextEditable = true
            BrainrotWebhookInput.TextColor3 = Color3.fromRGB(255, 255, 255)
            _G.VortexHubValues = nil
        else
            ShowNotification("Auto Farm Brainrot", "Auto Farm ATIVADO com sucesso! Valor: " .. minValue, 3)
        end
    end)
end

local function StopBrainrotFarm()
    if not brainrotActive then return end
    
    -- Chamar função de parada do script
    if _G.StopBrainrotFarm then
        pcall(_G.StopBrainrotFarm)
    end
    
    -- Parar a thread do auto farm
    if brainrotThread then
        task.cancel(brainrotThread)
        brainrotThread = nil
    end
    
    -- Limpar variáveis globais
    _G.VortexHubValues = nil
    _G.VortexHubBrainrotLoaded = nil
    
    -- Remover do ActiveToggles
    ActiveToggles["BrainrotFarm"] = nil
    
    -- Atualizar estado
    brainrotActive = false
    TweenService:Create(BrainrotSwitch, TweenInfo.new(0.3), {BackgroundColor3 = Color3.fromRGB(60, 60, 75)}):Play()
    TweenService:Create(BrainrotCircle, TweenInfo.new(0.3), {Position = UDim2.new(0, 3, 0.5, -7), BackgroundColor3 = Color3.fromRGB(200, 200, 200)}):Play()
    
    -- Destravar campos
    BrainrotValueInput.TextEditable = true
    BrainrotValueInput.TextColor3 = Color3.fromRGB(255, 255, 255)
    BrainrotWebhookInput.TextEditable = true
    BrainrotWebhookInput.TextColor3 = Color3.fromRGB(255, 255, 255)
    
    ShowNotification("Auto Farm Brainrot", "Auto Farm DESATIVADO", 3)
end