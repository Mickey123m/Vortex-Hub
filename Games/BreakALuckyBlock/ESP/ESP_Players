local Players = game:GetService("Players")
local CoreGui = game:GetService("CoreGui")
local localPlayer = Players.LocalPlayer

if _G.VortexPureOutlineActive == nil then _G.VortexPureOutlineActive = false end
_G.VortexPureOutlineActive = not _G.VortexPureOutlineActive

if _G.VortexConnections == nil then _G.VortexConnections = {} end

local function cleanup()
    for _, obj in pairs(CoreGui:GetChildren()) do
        if obj.Name == "VortexPureOutline" then
            obj:Destroy()
        end
    end
    for _, conn in pairs(_G.VortexConnections) do
        if conn then
            conn:Disconnect()
        end
    end
    _G.VortexConnections = {}
end

if not _G.VortexPureOutlineActive then
    cleanup()
    return
end

local function applyPureOutline(player)
    if player == localPlayer then return end

    local function onCharacterAdded(char)
        for _, old in pairs(CoreGui:GetChildren()) do
            if old.Name == "VortexPureOutline" and old:GetAttribute("Target") == player.Name then
                old:Destroy()
            end
        end

        local highlight = Instance.new("Highlight")
        highlight.Name = "VortexPureOutline"
        highlight.Adornee = char
        highlight.FillTransparency = 1 
        highlight.OutlineColor = Color3.fromRGB(255, 0, 0)
        highlight.OutlineTransparency = 0 
        highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
        highlight.Parent = CoreGui
        highlight:SetAttribute("Target", player.Name)
    end

    local charConn = player.CharacterAdded:Connect(onCharacterAdded)
    table.insert(_G.VortexConnections, charConn)

    if player.Character then
        onCharacterAdded(player.Character)
    end
end

cleanup()

local playerAddedConn = Players.PlayerAdded:Connect(applyPureOutline)
table.insert(_G.VortexConnections, playerAddedConn)

for _, p in pairs(Players:GetPlayers()) do
    applyPureOutline(p)
end