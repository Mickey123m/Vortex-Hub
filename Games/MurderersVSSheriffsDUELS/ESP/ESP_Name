_G.NameTagEspEnabled = true

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local lp = Players.LocalPlayer

if _G.NameTagLoop then _G.NameTagLoop:Disconnect() end

_G.NameTagLoop = RunService.Heartbeat:Connect(function()
    if not _G.NameTagEspEnabled then 
        for _, p in ipairs(Players:GetPlayers()) do
            if p.Character and p.Character:FindFirstChild("EnemyNameTag") then
                p.Character.EnemyNameTag:Destroy()
            end
        end
        return 
    end

    local char_lp = lp.Character
    local localRoot = char_lp and char_lp:FindFirstChild("HumanoidRootPart")

    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= lp then
            local char = player.Character
            local root = char and char:FindFirstChild("HumanoidRootPart")
            
            if char and root and player.Team ~= lp.Team then
                local dist = localRoot and (localRoot.Position - root.Position).Magnitude or 0
                
                local b = char:FindFirstChild("EnemyNameTag") or Instance.new("BillboardGui")
                b.Name = "EnemyNameTag"
                b.AlwaysOnTop = true
                b.Size = UDim2.new(0, 200, 0, 50)
                b.ExtentsOffset = Vector3.new(0, 3, 0)
                b.Adornee = char:FindFirstChild("Head") or root
                b.Parent = char
                
                local l = b:FindFirstChild("NameLabel") or Instance.new("TextLabel", b)
                l.Name = "NameLabel"
                l.BackgroundTransparency = 1
                l.Size = UDim2.new(1, 0, 1, 0)
                l.TextSize = 16
                l.Font = Enum.Font.SourceSansBold
                l.TextColor3 = Color3.new(1, 0, 0)
                l.TextStrokeTransparency = 0
                l.Text = player.Name .. " [" .. math.floor(dist) .. "m]"
            else
                if char and char:FindFirstChild("EnemyNameTag") then
                    char.EnemyNameTag:Destroy()
                end
            end
        end
    end
end)