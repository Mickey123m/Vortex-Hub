-- Script para Ativar ESP
_G.ESP_Enabled = true -- Vari√°vel global para controle

local workspace = game:GetService("Workspace")
local playersService = game:GetService("Players")
local map = workspace:WaitForChild("map")

local function createHighlight(model, color, name)
    if model and not model:FindFirstChild(name) then
        local highlight = Instance.new("Highlight")
        highlight.Name = name
        highlight.FillColor = color
        highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
        highlight.FillTransparency = 0.5
        highlight.OutlineTransparency = 0
        highlight.Adornee = model
        highlight.Parent = model
    end
end

-- 1. ESP PARA CHESTS (Laranja)
local function setupChestsESP(folder)
    for _, chest in ipairs(folder:GetChildren()) do
        if chest:IsA("Model") and _G.ESP_Enabled then
            createHighlight(chest, Color3.fromRGB(255, 165, 0), "ESP_Highlight_Chest")
        end
    end
    folder.ChildAdded:Connect(function(child)
        if child:IsA("Model") and _G.ESP_Enabled then
            createHighlight(child, Color3.fromRGB(255, 165, 0), "ESP_Highlight_Chest")
        end
    end)
end

local existingChests = map:FindFirstChild("Chests")
if existingChests then
    setupChestsESP(existingChests)
else
    local chestConn
    chestConn = map.ChildAdded:Connect(function(child)
        if child.Name == "Chests" then
            setupChestsESP(child)
            chestConn:Disconnect()
        end
    end)
end

-- 2. ESP PARA O KILLER (Vermelho)
local function applyKillerESP(player)
    task.spawn(function()
        while _G.ESP_Enabled do
            local character = player.Character
            local backpack = player:FindFirstChild("Backpack")
            local hasTransform = (backpack and backpack:FindFirstChild("Transform")) or (character and character:FindFirstChild("Transform"))
            
            if character and hasTransform then
                createHighlight(character, Color3.fromRGB(255, 0, 0), "ESP_Highlight_Killer")
            elseif character then
                local h = character:FindFirstChild("ESP_Highlight_Killer")
                if h then h:Destroy() end
            end
            task.wait(1)
        end
    end)
end

for _, p in ipairs(playersService:GetPlayers()) do
    applyKillerESP(p)
end

playersService.PlayerAdded:Connect(applyKillerESP)

print("ESP Ativado")