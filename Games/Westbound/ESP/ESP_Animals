-- SERVIÃ‡OS
local Workspace = game:GetService("Workspace")
local Players = game:GetService("Players")
local CoreGui = game:GetService("CoreGui")

local LocalPlayer = Players.LocalPlayer
local ESP_COLOR = Color3.fromRGB(255, 255, 0)

if CoreGui:FindFirstChild("ANIMAL_ESP_FOLDER") then
	CoreGui.ANIMAL_ESP_FOLDER:Destroy()
end

local Folder = Instance.new("Folder")
Folder.Name = "ANIMAL_ESP_FOLDER"
Folder.Parent = CoreGui

shared.AnimalESP_Data = {}
shared.AnimalESP_Running = true

local function GetName(name) return name:match("^(.-)%{") or name end

local function CreateAnimalESP(animal)
	local main = animal:FindFirstChild("HumanoidRootPart") or animal:FindFirstChildWhichIsA("BasePart")
	if not main then task.wait(0.5) main = animal:FindFirstChildWhichIsA("BasePart") end
	if not main then return end

	local highlight = Instance.new("Highlight")
	highlight.Adornee = animal
	highlight.FillColor = ESP_COLOR
	highlight.OutlineColor = Color3.new(1,1,1)
	highlight.FillTransparency = 0.5
	highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
	highlight.Parent = Folder

	local billboard = Instance.new("BillboardGui")
	billboard.Adornee = main
	billboard.Size = UDim2.fromOffset(200, 45)
	billboard.StudsOffset = Vector3.new(0, 3, 0)
	billboard.AlwaysOnTop = true
	billboard.Parent = Folder

	local text = Instance.new("TextLabel")
	text.Size = UDim2.fromScale(1, 1)
	text.BackgroundTransparency = 1
	text.TextColor3 = ESP_COLOR
	text.TextStrokeTransparency = 0
	text.Font = Enum.Font.GothamBold
	text.TextSize = 14
	text.Parent = billboard

	shared.AnimalESP_Data[animal] = {Main = main, Text = text}
end

local animalsFolder = Workspace:WaitForChild("Animals", 10)
if animalsFolder then
	for _, a in ipairs(animalsFolder:GetChildren()) do task.spawn(CreateAnimalESP, a) end
	animalsFolder.ChildAdded:Connect(function(a)
		if shared.AnimalESP_Running then task.wait(0.5) CreateAnimalESP(a) end
	end)
end

task.spawn(function()
	while shared.AnimalESP_Running do
		local myRoot = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
		for animal, data in pairs(shared.AnimalESP_Data) do
			if animal and animal.Parent and data.Main and data.Main.Parent then
				if myRoot then
					local dist = (myRoot.Position - data.Main.Position).Magnitude
					data.Text.Text = GetName(animal.Name) .. "\n[" .. math.floor(dist) .. "m]"
				end
			else
				shared.AnimalESP_Data[animal] = nil
			end
		end
		task.wait(0.1)
	end
end)
print("[ANIMAL ESP] ATIVADO")