local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

local function applyHighlight(player)
    -- Verifica se o jogador não é você mesmo
    if player == LocalPlayer then return end

    local function onCharacterAdded(character)
        -- Remove highlights antigos para evitar duplicação ao renascer
        if character:FindFirstChildOfClass("Highlight") then
            character:FindFirstChildOfClass("Highlight"):Destroy()
        end

        -- Cria uma nova instância de Highlight e define as propriedades
        local highlight = Instance.new("Highlight")
        highlight.Parent = character
        highlight.Name = "ESPHighlight"
        highlight.Archivable = true
        highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
        highlight.Enabled = true
        highlight.FillColor = Color3.fromRGB(255, 0, 4)
        highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
        highlight.FillTransparency = 0.5
        highlight.OutlineTransparency = 0
    end

    -- Se o personagem do jogador já existir, aplica o destaque
    if player.Character then
        onCharacterAdded(player.Character)
    end

    -- Conecta-se a CharacterAdded para garantir que o destaque seja aplicado sempre que renascer
    player.CharacterAdded:Connect(onCharacterAdded)
end

-- Aplica o destaque a todos os jogadores atuais (exceto você)
for _, player in pairs(Players:GetPlayers()) do
    applyHighlight(player)
end

-- Escuta novos jogadores entrando (aplica a lógica neles também)
Players.PlayerAdded:Connect(applyHighlight)