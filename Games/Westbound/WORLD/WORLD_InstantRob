local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local RobEvent = ReplicatedStorage.GeneralEvents.Rob

-- Limpeza de seguran√ßa
if _G.RobConnection then _G.RobConnection:Disconnect() end
if _G.CharAddedConn then _G.CharAddedConn:Disconnect() end

_G.AutoRobActive = true
local playerCooldowns = {} 

-- CONFIGURA√á√ïES
local WORK_TIME = 8      
local REST_TIME = 1.2    
local AURA_DISTANCE = 50 
local PLAYER_DISTANCE = 12 

-- Tabela de limites de bolsa permitidos
local BAG_LIMITS = {40, 50, 60, 70, 80, 90, 100}

local ContextMain, hrp, statesFolder
local isResting = false

-- Fun√ß√£o de Verifica√ß√£o Um por Um
local function isBagFull()
    if statesFolder then
        local bagValue = statesFolder:FindFirstChild("Bag")
        if bagValue and bagValue:IsA("ValueBase") then
            local currentAmount = bagValue.Value
            
            -- Verifica se o valor atual corresponde a qualquer um dos limites cheios
            for _, limit in ipairs(BAG_LIMITS) do
                if currentAmount == limit then
                    return true
                end
            end
        end
    end
    return false
end

local function updateReferences(char)
    if not char then return end
    hrp = char:WaitForChild("HumanoidRootPart", 10)
    statesFolder = player:WaitForChild("States", 10)
    
    local contextActions = char:WaitForChild("ContextActions", 10)
    local contextMainModule = contextActions and contextActions:WaitForChild("ContextMain", 10)
    
    if contextMainModule then
        local success, module = pcall(require, contextMainModule)
        if success then ContextMain = module end
    end
end

local function instantClick()
    if ContextMain and ContextMain.ResetContextHoldGui then
        ContextMain:ResetContextHoldGui(true)
    end
end

-- Ciclo de Vida (Descanso do F)
task.spawn(function()
    while _G.AutoRobActive do
        isResting = false
        task.wait(WORK_TIME)
        isResting = true
        if ContextMain and ContextMain.ResetContextHoldGui then
            ContextMain:ResetContextHoldGui(false)
        end
        task.wait(REST_TIME)
    end
end)

local function runRobCycle()
    if not _G.AutoRobActive or not hrp or not ContextMain or isResting then return end
    
    -- Verifica√ß√£o de Bag
    if isBagFull() then return end

    local currentPos = hrp.Position

    -- Registradoras
    if ContextMain.CashRegisters then
        for _, reg in pairs(ContextMain.CashRegisters) do
            if reg.Part and reg.ActiveValue and reg.ActiveValue.Value then
                if (reg.Part.Position - currentPos).Magnitude <= AURA_DISTANCE then
                    instantClick()
                    RobEvent:FireServer("Register", reg)
                end
            end
        end
    end

    -- Cofres
    if ContextMain.Safes then
        for _, safe in pairs(ContextMain.Safes) do
            if safe.Safe and not safe.Active then
                if (safe.Safe.Position - currentPos).Magnitude <= AURA_DISTANCE then
                    instantClick()
                    RobEvent:FireServer("Safe", safe)
                end
            end
        end
    end

    -- Players
    for _, plr in pairs(Players:GetPlayers()) do
        if plr ~= player and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
            if not player:IsFriendsWith(plr.UserId) then
                local targetHrp = plr.Character.HumanoidRootPart
                if (targetHrp.Position - currentPos).Magnitude <= PLAYER_DISTANCE then
                    local hum = plr.Character:FindFirstChild("Humanoid")
                    if hum and hum.Health > 0 then
                        local lastRob = playerCooldowns[plr.UserId] or 0
                        if (tick() - lastRob) >= 15 then
                            instantClick()
                            RobEvent:FireServer("Player", plr)
                            playerCooldowns[plr.UserId] = tick()
                        end
                    end
                end
            end
        end
    end
end

updateReferences(player.Character)

_G.CharAddedConn = player.CharacterAdded:Connect(function(newChar)
    task.wait(1.5)
    updateReferences(newChar)
end)

_G.RobConnection = RunService.Heartbeat:Connect(runRobCycle)

print("üöÄ AUTO-ROUBO: Verifica√ß√£o Exata (40-100) Ativa")