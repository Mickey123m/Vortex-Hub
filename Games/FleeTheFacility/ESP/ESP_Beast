local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

_G.BEAST_ESP_ENABLED = true

local function getIsBeast(player)
    local module = player:FindFirstChild("TempPlayerStatsModule")
    if module then
        local success, stats = pcall(function() return require(module) end)
        if success and type(stats) == "table" and stats.IsBeast == true then
            return true
        end
        if module:GetAttribute("IsBeast") == true then return true end
    end
    if player.Character and player.Character:FindFirstChild("Hammer") then
        return true
    end
    return false
end

local function applyBeastESP()
    if not _G.BEAST_ESP_ENABLED then return end
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character then
            local isBeast = getIsBeast(player)
            local highlight = player.Character:FindFirstChild("BeastHighlight")
            
            if isBeast then
                if not highlight then
                    highlight = Instance.new("Highlight")
                    highlight.Name = "BeastHighlight"
                    highlight.Parent = player.Character
                end
                highlight.FillColor = Color3.fromRGB(255, 0, 0)
                highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
                highlight.FillTransparency = 0.5
                highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
                highlight.Enabled = true
            elseif highlight then
                highlight:Destroy()
            end
        end
    end
end

if _G.BEAST_CONNECTION then _G.BEAST_CONNECTION:Disconnect() end
_G.BEAST_CONNECTION = RunService.RenderStepped:Connect(applyBeastESP)