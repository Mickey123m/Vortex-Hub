local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local VirtualInputManager = game:GetService("VirtualInputManager")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

local ToggleKey = "Vortex_AutoTrigger_Control"
local MaxDistance = 1000
local Cooldown = 0.1

if _G[ToggleKey] then
    _G[ToggleKey] = nil
    if _G.TriggerConnection then
        _G.TriggerConnection:Disconnect()
        _G.TriggerConnection = nil
    end
    warn("AUTO-TRIGGER: >>> DESATIVADO <<<")
    return
end

_G[ToggleKey] = true
warn("AUTO-TRIGGER: >>> ATIVADO <<<")

local isShooting = false
local function shoot()
    if isShooting then return end
    isShooting = true
    
    VirtualInputManager:SendMouseButtonEvent(0, 0, 0, true, game, 0)
    task.wait(0.02)
    VirtualInputManager:SendMouseButtonEvent(0, 0, 0, false, game, 0)
    
    task.wait(Cooldown)
    isShooting = false
end

_G.TriggerConnection = RunService.RenderStepped:Connect(function()
    if not _G[ToggleKey] then return end

    local mousePos = Camera.ViewportSize / 2
    local unitRay = Camera:ViewportPointToRay(mousePos.X, mousePos.Y)
    
    local rayParams = RaycastParams.new()
    rayParams.FilterType = Enum.RaycastFilterType.Exclude
    rayParams.FilterDescendantsInstances = {LocalPlayer.Character}
    
    local rayResult = workspace:Raycast(unitRay.Origin, unitRay.Direction * MaxDistance, rayParams)
    
    if rayResult and rayResult.Instance then
        local hitObject = rayResult.Instance
        local character = hitObject:FindFirstAncestorOfClass("Model")
        
        if character then
            local targetPlayer = Players:GetPlayerFromCharacter(character)
            
            if targetPlayer and targetPlayer ~= LocalPlayer then
                if targetPlayer.Team ~= LocalPlayer.Team then
                    local humanoid = character:FindFirstChildOfClass("Humanoid")
                    if humanoid and humanoid.Health > 0 then
                        task.spawn(shoot)
                    end
                end
            end
        end
    end
end)