-- Auto KeyCard for Prison Life
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

local isActive = false
local checkInterval = 3 -- seconds

local function HasKeyCard()
    local backpack = LocalPlayer:FindFirstChild("Backpack")
    local character = LocalPlayer.Character
    
    if backpack then
        for _, item in pairs(backpack:GetChildren()) do
            if string.find(item.Name:lower(), "key") then
                return true
            end
        end
    end
    
    if character then
        for _, item in pairs(character:GetChildren()) do
            if string.find(item.Name:lower(), "key") then
                return true
            end
        end
    end
    
    return false
end

local function FindAndPickupKeyCard()
    if HasKeyCard() then
        return false
    end
    
    pcall(function()
        local foundKeyCard = nil
        
        -- Search for keycard in workspace
        for _, item in pairs(workspace:GetDescendants()) do
            if item:IsA("Model") and string.find(item.Name:lower(), "key") then
                local mesh = item:FindFirstChild("Mesh") or item:FindFirstChildWhichIsA("MeshPart")
                if mesh then
                    foundKeyCard = item
                    break
                end
            end
        end
        
        if foundKeyCard then
            local char = LocalPlayer.Character
            local humanoidRootPart = char and char:FindFirstChild("HumanoidRootPart")
            
            if humanoidRootPart then
                local itemPosition = foundKeyCard:GetModelCFrame().Position
                local teleportCFrame = CFrame.new(itemPosition + Vector3.new(0, 2, 2))
                
                -- Save position and teleport
                local originalPosition = humanoidRootPart.CFrame
                humanoidRootPart.CFrame = teleportCFrame
                task.wait(0.1)
                
                -- Wait and return
                task.wait(1.5)
                humanoidRootPart.CFrame = originalPosition
                task.wait(0.1)
                
                if HasKeyCard() then
                    print("[Prison Life] Picked up KeyCard successfully!")
                    return true
                else
                    print("[Prison Life] Couldn't pick up KeyCard")
                    return false
                end
            end
        end
    end)
    
    return false
end

local function ToggleAutoKeyCard(state)
    isActive = state
    
    if state then
        print("[Prison Life] Auto KeyCard: ON")
        
        -- Start auto pickup loop
        task.spawn(function()
            while isActive do
                FindAndPickupKeyCard()
                task.wait(checkInterval)
            end
        end)
        
        return "Auto KeyCard: ON"
    else
        print("[Prison Life] Auto KeyCard: OFF")
        return "Auto KeyCard: OFF"
    end
end

return ToggleAutoKeyCard