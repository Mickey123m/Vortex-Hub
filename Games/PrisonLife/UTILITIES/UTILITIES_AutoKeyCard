-- Auto KeyCard for Prison Life
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

local isActive = false
local checkInterval = 1 

local function HasKeyCard()
    local backpack = LocalPlayer:FindFirstChild("Backpack")
    local character = LocalPlayer.Character
    
    local found = false
    if backpack then
        for _, item in pairs(backpack:GetChildren()) do
            if string.find(item.Name:lower(), "key") then found = true break end
        end
    end
    if character and not found then
        for _, item in pairs(character:GetChildren()) do
            if string.find(item.Name:lower(), "key") then found = true break end
        end
    end
    
    return found
end

local function FindAndPickupKeyCard()
    if HasKeyCard() then return false end
    
    local foundKeyCard = nil
    
    local targets = {workspace, workspace:FindFirstChild("DroppedItems")}
    
    for _, parent in pairs(targets) do
        if parent then
            for _, item in pairs(parent:GetChildren()) do
                if string.find(item.Name:lower(), "key") then
                    if item:IsA("Tool") or item:IsA("Model") or item:IsA("Part") then
                        foundKeyCard = item
                        break
                    end
                end
            end
        end
        if foundKeyCard then break end
    end

    if foundKeyCard then
        local char = LocalPlayer.Character
        local humanoidRootPart = char and char:FindFirstChild("HumanoidRootPart")
        local humanoid = char and char:FindFirstChildOfClass("Humanoid")
        
        local targetPos
        if foundKeyCard:IsA("Tool") and foundKeyCard:FindFirstChild("Handle") then
            targetPos = foundKeyCard.Handle.Position
        else
            targetPos = foundKeyCard:GetPivot().Position
        end

        if humanoidRootPart and humanoid then
            print("[Prison Life] KeyCard detectada no ch√£o! Teleportando...")
            
            local originalPosition = humanoidRootPart.CFrame
            
            humanoid:SetStateEnabled(Enum.HumanoidStateType.FallingDown, false)
            humanoidRootPart.Velocity = Vector3.new(0, 0, 0)
            humanoidRootPart.RotVelocity = Vector3.new(0, 0, 0)
            
            local camDirection = (Camera.CFrame.Position - targetPos).Unit
            local finalPos = targetPos + Vector3.new(0, 10, 0) + (camDirection * 4)
            
            char:PivotTo(CFrame.new(finalPos, targetPos))
            
            task.spawn(function()
                local remote = workspace:FindFirstChild("Remote") and workspace.Remote:FindFirstChild("ItemHandler")
                for i = 1, 15 do
                    if remote then
                        remote:InvokeServer(foundKeyCard)
                    end
                    if char then char:TranslateBy(Vector3.new(0, -0.1, 0)) end
                    task.wait(0.05)
                end
            end)
            
            ---------------------------------------------------------
            -- ALTERE O VALOR ABAIXO PARA CONTROLAR O TEMPO DE VOLTA
            ---------------------------------------------------------
            task.wait(2.0) -- Estava 0.8, agora deixei 2 segundos.
            
            humanoidRootPart.Velocity = Vector3.new(0, 0, 0)
            char:PivotTo(originalPosition)
            humanoid:SetStateEnabled(Enum.HumanoidStateType.FallingDown, true)
            
            return true
        end
    end
    return false
end

local function ToggleAutoKeyCard(state)
    isActive = state
    
    if state then
        print("[Prison Life] Auto KeyCard: ATIVADO")
        task.spawn(function()
            while isActive do
                FindAndPickupKeyCard()
                task.wait(checkInterval)
            end
        end)
        return "Auto KeyCard: ON"
    else
        print("[Prison Life] Auto KeyCard: DESATIVADO")
        return "Auto KeyCard: OFF"
    end
end

ToggleAutoKeyCard(true)

return ToggleAutoKeyCard