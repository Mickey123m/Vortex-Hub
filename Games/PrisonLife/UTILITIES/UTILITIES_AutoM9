-- Auto M9 for Prison Life
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

local isActive = false
local checkInterval = 3 -- seconds

local function HasM9()
    local backpack = LocalPlayer:FindFirstChild("Backpack")
    local character = LocalPlayer.Character
    
    if backpack then
        for _, item in pairs(backpack:GetChildren()) do
            if string.find(item.Name:lower(), "m9") then
                return true
            end
        end
    end
    
    if character then
        for _, item in pairs(character:GetChildren()) do
            if string.find(item.Name:lower(), "m9") then
                return true
            end
        end
    end
    
    return false
end

local function FindAndPickupM9()
    if HasM9() then
        return false
    end
    
    pcall(function()
        local foundM9 = nil
        
        -- Search for M9 in workspace
        for _, item in pairs(workspace:GetDescendants()) do
            if item:IsA("Model") and string.find(item.Name:lower(), "m9") then
                local mesh = item:FindFirstChild("Mesh") or item:FindFirstChildWhichIsA("MeshPart")
                if mesh then
                    foundM9 = item
                    break
                end
            end
        end
        
        if foundM9 then
            local char = LocalPlayer.Character
            local humanoidRootPart = char and char:FindFirstChild("HumanoidRootPart")
            
            if humanoidRootPart then
                local itemPosition = foundM9:GetModelCFrame().Position
                local teleportCFrame = CFrame.new(itemPosition + Vector3.new(0, 2, 2))
                
                -- Save position and teleport
                local originalPosition = humanoidRootPart.CFrame
                humanoidRootPart.CFrame = teleportCFrame
                task.wait(0.1)
                
                -- Wait and return
                task.wait(1.5)
                humanoidRootPart.CFrame = originalPosition
                task.wait(0.1)
                
                if HasM9() then
                    print("[Prison Life] Picked up M9 successfully!")
                    return true
                else
                    print("[Prison Life] Couldn't pick up M9")
                    return false
                end
            end
        end
    end)
    
    return false
end

local function ToggleAutoM9(state)
    isActive = state
    
    if state then
        print("[Prison Life] Auto M9: ON")
        
        -- Start auto pickup loop
        task.spawn(function()
            while isActive do
                FindAndPickupM9()
                task.wait(checkInterval)
            end
        end)
        
        return "Auto M9: ON"
    else
        print("[Prison Life] Auto M9: OFF")
        return "Auto M9: OFF"
    end
end

return ToggleAutoM9