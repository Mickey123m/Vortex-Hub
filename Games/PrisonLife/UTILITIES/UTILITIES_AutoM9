-- Auto M9 (Ativar)
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

_G.AutoM9Active = true -- Variável global obrigatória

local function HasM9()
    local b = LocalPlayer:FindFirstChild("Backpack")
    local c = LocalPlayer.Character
    if b then for _, i in pairs(b:GetChildren()) do if string.find(i.Name:lower(), "m9") then return true end end end
    if c then for _, i in pairs(c:GetChildren()) do if string.find(i.Name:lower(), "m9") then return true end end end
    return false
end

task.spawn(function()
    print("[Prison Life] Auto M9: ATIVADO")
    while _G.AutoM9Active do
        if not HasM9() then
            local prisonItems = workspace:FindFirstChild("Prison_ITEMS")
            local giverFolder = prisonItems and prisonItems:FindFirstChild("giver")
            local found = giverFolder and giverFolder:FindFirstChild("M9")

            if found then
                local char = LocalPlayer.Character
                local hrp = char and char:FindFirstChild("HumanoidRootPart")
                if hrp then
                    local originalPos = hrp.CFrame
                    local targetPos = found:GetPivot().Position
                    local camDir = (Camera.CFrame.Position - targetPos).Unit
                    hrp.CFrame = CFrame.new(targetPos + Vector3.new(0, 10, 0) + (camDir * 4), targetPos)
                    
                    task.spawn(function()
                        for i = 1, 15 do
                            if workspace:FindFirstChild("Remote") and workspace.Remote:FindFirstChild("ItemHandler") then
                                workspace.Remote.ItemHandler:InvokeServer(found)
                            end
                            task.wait(0.05)
                        end
                    end)
                    task.wait(2.0)
                    hrp.CFrame = originalPos
                end
            end
        end
        task.wait(1)
    end
    print("[Prison Life] Auto M9: PARADO")
end)