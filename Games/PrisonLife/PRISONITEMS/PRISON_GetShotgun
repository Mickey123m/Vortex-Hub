local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

local function GetShotgun()
    print("[Prison Life] Getting Shotgun...")
    
    local char = LocalPlayer.Character
    local humanoidRootPart = char and char:FindFirstChild("HumanoidRootPart")
    local humanoid = char and char:FindFirstChildOfClass("Humanoid")
    
    if not humanoidRootPart or not humanoid then
        return "Error: Character not found"
    end
    
    local prisonItems = workspace:FindFirstChild("Prison_ITEMS")
    local giverFolder = prisonItems and prisonItems:FindFirstChild("giver")
    
    -- Busca pela Remington 870 ou Criminal Remington
    local shotgun = giverFolder and (giverFolder:FindFirstChild("Remington 870") or giverFolder:FindFirstChild("Criminal Remington"))
    
    if not shotgun then
        for _, item in pairs(giverFolder:GetChildren()) do
            if string.find(item.Name:lower(), "remington") or string.find(item.Name:lower(), "shotgun") then
                shotgun = item
                break
            end
        end
    end
    
    if not shotgun then return "Error: Shotgun not found" end
    
    local originalPosition = humanoidRootPart.CFrame
    
    humanoid:SetStateEnabled(Enum.HumanoidStateType.FallingDown, false)
    humanoidRootPart.Velocity = Vector3.new(0, 0, 0)
    humanoidRootPart.RotVelocity = Vector3.new(0, 0, 0)
    
    local itemPos = shotgun:GetPivot().Position
    local camDirection = (Camera.CFrame.Position - itemPos).Unit
    
    -- Mantida a posição exata do seu script da AK: +2 lateral, +10 altura, +4 direção tela
    local finalPos = itemPos + Vector3.new(0, 0, -2) + (camDirection * 4)
    
    char:PivotTo(CFrame.new(finalPos, itemPos))
    
    task.spawn(function()
        for i = 1, 10 do
            if workspace:FindFirstChild("Remote") and workspace.Remote:FindFirstChild("ItemHandler") then
                workspace.Remote.ItemHandler:InvokeServer(shotgun)
            end
            task.wait(0.05)
        end
    end)

    task.wait(0.6)

    humanoidRootPart.Velocity = Vector3.new(0, 0, 0)
    char:PivotTo(originalPosition)
    
    humanoid:SetStateEnabled(Enum.HumanoidStateType.FallingDown, true)
    
    return "Done"
end

return GetShotgun()