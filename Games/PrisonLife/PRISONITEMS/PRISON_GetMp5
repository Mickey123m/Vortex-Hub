-- Get MP5 for Prison Life
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

local function GetMP5()
    print("[Prison Life] Getting MP5...")
    
    local char = LocalPlayer.Character
    local humanoidRootPart = char and char:FindFirstChild("HumanoidRootPart")
    
    if not humanoidRootPart then
        print("[Prison Life] Character not found!")
        return "Error: Character not found"
    end
    
    -- Find prison items folder
    local prisonItems = workspace:FindFirstChild("Prison_ITEMS")
    if not prisonItems then
        return "Error: Prison_ITEMS folder not found"
    end
    
    local giverFolder = prisonItems:FindFirstChild("giver")
    if not giverFolder then
        return "Error: 'giver' folder not found"
    end
    
    -- Look for MP5
    local mp5 = giverFolder:FindFirstChild("MP5")
    if not mp5 then
        -- Try to find by partial name
        for _, item in pairs(giverFolder:GetChildren()) do
            if item:IsA("Model") and string.find(item.Name:lower(), "mp5") then
                mp5 = item
                break
            end
        end
    end
    
    if not mp5 or not mp5:IsA("Model") then
        return "Error: MP5 not found"
    end
    
    print("[Prison Life] Found MP5: " .. mp5.Name)
    
    -- Save current position
    local originalPosition = humanoidRootPart.CFrame
    
    -- Teleport to MP5
    local itemPosition = mp5:GetModelCFrame().Position
    local teleportCFrame = CFrame.new(itemPosition + Vector3.new(0, 2, 2))
    
    humanoidRootPart.CFrame = teleportCFrame
    task.wait(0.1)
    
    -- Wait and return
    task.wait(1.5)
    humanoidRootPart.CFrame = originalPosition
    task.wait(0.1)
    
    -- Check if weapon was picked up
    local function HasWeapon()
        local backpack = LocalPlayer:FindFirstChild("Backpack")
        local character = LocalPlayer.Character
        
        if backpack then
            for _, item in pairs(backpack:GetChildren()) do
                if string.find(item.Name:lower(), "mp5") then
                    return true
                end
            end
        end
        
        if character then
            for _, item in pairs(character:GetChildren()) do
                if string.find(item.Name:lower(), "mp5") then
                    return true
                end
            end
        end
        
        return false
    end
    
    if HasWeapon() then
        print("[Prison Life] Successfully picked up MP5!")
        return "MP5 acquired!"
    else
        print("[Prison Life] Couldn't pick up MP5 (click manually)")
        return "Click on MP5 to pick up"
    end
end

return GetMP5