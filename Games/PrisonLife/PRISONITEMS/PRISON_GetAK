-- Get AK-47 for Prison Life
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

local function GetAK47()
    print("[Prison Life] Getting AK-47...")
    
    local char = LocalPlayer.Character
    local humanoidRootPart = char and char:FindFirstChild("HumanoidRootPart")
    
    if not humanoidRootPart then
        print("[Prison Life] Character not found!")
        return "Error: Character not found"
    end
    
    -- Find prison items folder
    local prisonItems = workspace:FindFirstChild("Prison_ITEMS")
    if not prisonItems then
        return "Error: Prison_ITEMS folder not found"
    end
    
    local giverFolder = prisonItems:FindFirstChild("giver")
    if not giverFolder then
        return "Error: 'giver' folder not found"
    end
    
    -- Look for AK-47
    local ak47 = giverFolder:FindFirstChild("AK-47")
    if not ak47 then
        -- Try to find by partial name
        for _, item in pairs(giverFolder:GetChildren()) do
            if item:IsA("Model") and (string.find(item.Name:lower(), "ak") or string.find(item.Name:lower(), "ak47")) then
                ak47 = item
                break
            end
        end
    end
    
    if not ak47 or not ak47:IsA("Model") then
        return "Error: AK-47 not found"
    end
    
    print("[Prison Life] Found AK-47: " .. ak47.Name)
    
    -- Save current position
    local originalPosition = humanoidRootPart.CFrame
    
    -- Teleport to AK-47
    local itemPosition = ak47:GetModelCFrame().Position
    local teleportCFrame = CFrame.new(itemPosition + Vector3.new(0, 2, 3))
    
    humanoidRootPart.CFrame = teleportCFrame
    task.wait(0.1)
    
    -- Wait and return
    task.wait(1.5)
    humanoidRootPart.CFrame = originalPosition
    task.wait(0.1)
    
    -- Check if weapon was picked up
    local function HasWeapon()
        local backpack = LocalPlayer:FindFirstChild("Backpack")
        local character = LocalPlayer.Character
        
        if backpack then
            for _, item in pairs(backpack:GetChildren()) do
                if string.find(item.Name:lower(), "ak") then
                    return true
                end
            end
        end
        
        if character then
            for _, item in pairs(character:GetChildren()) do
                if string.find(item.Name:lower(), "ak") then
                    return true
                end
            end
        end
        
        return false
    end
    
    if HasWeapon() then
        print("[Prison Life] Successfully picked up AK-47!")
        return "AK-47 acquired!"
    else
        print("[Prison Life] Couldn't pick up AK-47 (click manually)")
        return "Click on AK-47 to pick up"
    end
end

return GetAK47