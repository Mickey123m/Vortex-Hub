-- ESP PRISIONEIROS - EXECUTA UMA VEZ E MOSTRA
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

-- Estado (sempre ativo)
local ESP_Ativo = true
local Highlights = {}

-- Verifica se é prisioneiro
local function IsInmate(player)
    return player.Team and player.Team.Name == "Inmates"
end

-- Cria highlight
local function CreateHighlight(player, character)
    if not character then return end
    
    -- Remove antigo
    if Highlights[player] then
        Highlights[player]:Destroy()
    end
    
    -- Cria novo (só se for prisioneiro)
    if IsInmate(player) then
        local highlight = Instance.new("Highlight")
        highlight.Name = "ESP_Inmate"
        highlight.Adornee = character
        highlight.FillColor = Color3.fromRGB(255, 105, 180)
        highlight.OutlineColor = Color3.new(1, 1, 1)
        highlight.FillTransparency = 0.5
        highlight.OutlineTransparency = 0
        highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
        highlight.Enabled = ESP_Ativo
        
        highlight.Parent = character
        Highlights[player] = highlight
        print("ESP criado para: " .. player.Name .. " (Prisioneiro)")
    else
        print("Ignorado: " .. player.Name .. " (Não é prisioneiro)")
    end
end

-- Configura jogador
local function SetupPlayer(player)
    if player == LocalPlayer then return end
    
    -- Quando character aparece
    local function HandleCharacter(character)
        task.wait(0.5)
        CreateHighlight(player, character)
        
        -- Morte
        local humanoid = character:WaitForChild("Humanoid", 2)
        if humanoid then
            humanoid.Died:Connect(function()
                if Highlights[player] then
                    Highlights[player]:Destroy()
                    Highlights[player] = nil
                end
            end)
        end
    end
    
    -- Character atual
    if player.Character then
        task.spawn(HandleCharacter, player.Character)
    end
    
    -- Novo character
    player.CharacterAdded:Connect(HandleCharacter)
    
    -- Mudou time
    player:GetPropertyChangedSignal("Team"):Connect(function()
        -- Remove highlight antigo
        if Highlights[player] then
            Highlights[player]:Destroy()
            Highlights[player] = nil
        end
        -- Cria novo se agora for prisioneiro
        task.wait(0.1)
        if player.Character then
            CreateHighlight(player, player.Character)
        end
    end)
    
    -- Saiu do jogo
    player.AncestryChanged:Connect(function(_, parent)
        if not parent and Highlights[player] then
            Highlights[player]:Destroy()
            Highlights[player] = nil
        end
    end)
end

-- Inicializa
local function Initialize()
    print("Inicializando ESP Prisioneiros...")
    
    -- Configura jogadores atuais
    for _, player in pairs(Players:GetPlayers()) do
        task.spawn(SetupPlayer, player)
    end
    
    -- Novo jogador
    Players.PlayerAdded:Connect(function(player)
        task.wait(1)
        SetupPlayer(player)
    end)
    
    -- Jogador saiu
    Players.PlayerRemoving:Connect(function(player)
        if Highlights[player] then
            Highlights[player]:Destroy()
            Highlights[player] = nil
        end
    end)
end

-- EXECUTA AGORA
Initialize()

print("====================================")
print("ESP PRISIONEIROS ATIVADO!")
print("Só mostra jogadores do time 'Inmates'")
print("Cor: Rosa")
print("Status: SEMPRE ATIVO (executou uma vez)")
print("====================================")